---
title: 并行——使用流还是 CompletableFutures?
date: 2018-08-20 20:40:46
tags: [Stream, CompletableFuture]
---
#### 并行——使用流还是 CompletableFutures ?
目前为止,你已经知道对集合进行并行计算有两种方式:要么将其转化为并行流,利用 `map`这样的操作开展工作,要么枚举出集合中的每一个元素,创建新的线程,在 `CompletableFuture` 内对其进行操作。后者提供了更多的灵活性,你可以调整线程池的大小,而这能帮助你确保整体的计算不会因为线程都在等待I/O而发生阻塞。
我们对使用这些API的建议如下。
- 如果你进行的是计算密集型的操作,并且没有I/O,那么推荐使用 Stream 接口,因为实现简单,同时效率也可能是最高的(如果所有的线程都是计算密集型的,那就没有必要创建比处理器核数更多的线程)。
- 反之,如果你并行的工作单元还涉及等待I/O的操作(包括网络连接等待),那么使用`CompletableFuture` 灵活性更好,你可以像前文讨论的那样,依据`等待/计算`,或者`W/C`的比率设定需要使用的线程数。这种情况不使用并行流的另一个原因是,处理流的流水线中如果发生I/O等待,流的延迟特性会让我们很难判断到底什么时候触发了等待。
